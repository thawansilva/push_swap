#include "minunit.h"
#include "../libft/libft.h"
#include "../include/push_swap.h"
#include <stdio.h>
#include <string.h>
#include <fcntl.h>

char *run_push_swap_and_check(const char *args)
{
	static char result[16];
	char cmd[512];

	snprintf(cmd, sizeof(cmd),
	         "../push_swap %s | ../checker_linux %s > checker_result.txt",
	         args, args);

	int ret = system(cmd);
	if (ret != 0)
	{
		strcpy(result, "Error");
		return result;
	}

	FILE *fp = fopen("checker_result.txt", "r");
	if (!fp)
	{
		strcpy(result, "Error");
		return result;
	}

	fgets(result, sizeof(result), fp);
	fclose(fp);

	result[strcspn(result, "\n")] = 0; // remove newline
	return result;
}

MU_TEST(test_checker_valid_input)
{
    char *res = run_push_swap_and_check("-56 3 4 6 8 9 74 +495");
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("2 4 7 2147483647");
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("-2147483648 23 99 545");
	mu_assert_string_eq("OK", res);
}

MU_TEST(test_checker_invalid_input)
{
    char *res = run_push_swap_and_check("1 a 2");
	mu_assert_string_eq("Error", res);
    res = run_push_swap_and_check("1 2 1");
	mu_assert_string_eq("Error", res);
    res = run_push_swap_and_check("");
	mu_assert_string_eq("Error", res);
    res = run_push_swap_and_check("--1 9 10");
	mu_assert_string_eq("Error", res);
    res = run_push_swap_and_check("2147483648");
    mu_assert_string_eq("Error", res);
    res = run_push_swap_and_check("1 2 3-");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("1 --    45 32");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("12 4 6 8 54fhd 4354");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("a");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("1 3 dog 35 80 -3");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("1 3 dog 35 80 -3");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("54867543867438 3");
	mu_assert_string_eq("Error", res);
	res = run_push_swap_and_check("-2147483647765 4 5");
	mu_assert_string_eq("Error", res);
}

MU_TEST(test_checker_valid_signed_number)
{
    char *res = run_push_swap_and_check("-1 +1 2");
	mu_assert_string_eq("OK", res);
}

MU_TEST(test_checker_three_elements)
{
    char *res = run_push_swap_and_check("3 2 1");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("1 3 2");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("3 1 2");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("2 1 3");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("2 3 1");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("1 2 3");
    mu_assert_string_eq("OK", res);
}

MU_TEST(test_checker_five_elements)
{
	char *res = run_push_swap_and_check("0 1 2 3 4"); 
	mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("1 3 2 0 4");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("2 1 3 5 4");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("4 3 1 5 2");
    mu_assert_string_eq("OK", res);
    res = run_push_swap_and_check("4 3 1 2 5");
    mu_assert_string_eq("OK", res);
}

MU_TEST(test_checker_100_elements)
{
	char *res = run_push_swap_and_check("13 86 29 37 81 31 5 94 15 2 55 30 93 77 72 28 47 42 80 83 95 14 7 98 66 10 9 48 67 26 71 4 3 64 63 96 6 25 74 100 97 17 45 56 18 12 52 57 68 61 36 46 78 41 88 51 76 1 69 11 89 44 16 27 58 87 92 32 65 40 85 79 84 23 53 43 99 59 38 20 22 19 24 50 82 8 34 35 54 75 60 73 70 49 21 91 62 33 90 39"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("66 59 21 2 62 28 1 5 90 33 64 8 85 19 14 44 40 95 22 53 15 96 7 78 29 88 9 100 23 94 61 84 20 76 38 30 4 73 65 98 6 47 48 56 52 72 27 69 97 99 39 43 16 24 77 49 34 83 87 51 17 37 86 46 58 54 74 32 35 93 67 92 36 91 31 63 3 50 12 13 57 42 10 25 26 55 60 75 81 80 18 79 45 89 71 11 41 70 68 82"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("66 4 72 75 38 48 33 49 55 24 44 19 26 28 90 30 65 92 97 12 87 57 46 22 35 69 98 32 43 14 58 34 5 53 7 61 83 56 51 71 45 93 76 37 88 63 47 20 2 68 8 27 89 29 31 15 6 86 74 78 13 59 79 16 11 25 39 50 95 81 42 73 21 77 64 70 17 85 54 41 23 36 10 84 96 40 60 9 82 1 100 18 80 52 94 67 91 3 99 62"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("66 36 16 35 56 78 75 37 26 83 92 68 4 46 94 70 54 88 97 32 41 58 85 52 21 81 71 28 84 29 82 11 24 13 77 76 40 42 31 44 19 67 90 57 98 80 59 99 93 74 69 60 22 15 3 62 64 72 43 63 30 91 53 87 25 27 6 51 5 23 95 9 33 61 1 48 65 55 96 89 86 20 50 34 7 2 18 100 10 47 8 14 49 45 17 79 38 73 39 12"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("52 58 16 32 39 50 71 93 3 97 22 13 10 8 30 60 57 62 11 25 51 67 46 48 69 61 20 37 29 28 26 53 35 65 56 91 17 4 49 44 7 82 85 23 42 24 79 5 77 54 9 75 33 43 55 47 18 86 36 66 81 31 87 98 63 6 99 100 34 84 90 73 12 64 95 70 80 14 41 19 83 96 92 1 21 78 45 15 27 68 72 76 38 40 74 59 2 89 94 88"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("48 68 71 96 67 21 75 93 78 42 87 49 88 12 20 32 50 36 35 43 69 56 10 29 2 74 61 16 84 27 54 4 47 72 8 41 62 18 44 70 60 30 22 14 80 51 79 100 98 5 45 28 77 94 53 31 17 1 82 92 85 57 97 33 24 63 59 81 7 66 64 76 89 90 3 39 46 55 52 40 26 34 23 6 86 58 15 91 73 19 83 37 99 13 25 95 38 9 11 65"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("20 57 19 45 60 1 37 5 25 29 63 99 17 66 41 71 73 85 10 91 42 39 38 97 34 50 69 82 80 24 96 90 87 9 47 12 3 40 43 21 77 89 28 56 7 2 22 48 88 84 61 26 6 67 62 86 53 49 14 23 27 83 59 74 8 94 78 4 32 52 93 76 46 92 100 54 55 30 65 68 72 16 31 11 33 70 75 51 81 13 58 44 64 36 15 95 98 35 79 18"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("68 72 73 57 3 9 38 65 56 86 99 61 58 6 78 25 66 41 75 70 64 18 98 47 87 23 94 12 79 96 29 32 50 76 74 80 81 1 22 16 52 13 28 83 69 21 44 67 71 14 62 27 19 54 63 36 48 97 33 89 2 10 45 30 40 88 92 7 35 84 34 37 43 15 100 4 59 39 90 91 77 8 24 51 42 46 11 20 55 93 53 85 95 60 26 31 5 17 49 82"); 
	mu_assert_string_eq("OK", res);
}

MU_TEST(test_checker_500_elements)
{
	char *res = run_push_swap_and_check("68 275 84 61 435 467 174 474 429 130 178 160 459 184 305 189 182 143 53 255 391 46 245 222 126 105 215 436 486 96 306 246 336 199 162 289 304 97 41 338 370 176 94 415 488 334 183 288 389 277 271 446 452 223 33 227 402 116 495 460 123 489 22 173 179 491 16 290 493 303 91 414 453 187 205 307 236 282 456 258 318 181 374 175 350 408 95 278 365 314 330 21 121 472 497 342 43 477 273 73 448 457 208 88 376 423 20 349 154 207 209 150 264 119 155 455 261 430 172 287 301 500 425 269 426 292 210 482 469 226 225 158 185 134 191 48 463 7 212 485 343 165 267 240 204 67 407 54 6 230 127 450 32 310 104 357 108 323 366 196 235 381 351 397 481 339 213 44 9 8 394 55 136 249 106 368 202 23 324 313 295 499 131 15 26 80 231 232 125 86 337 396 188 190 468 157 192 135 242 109 129 270 177 363 170 98 180 198 433 233 5 406 361 248 250 308 447 272 25 341 76 364 268 63 333 114 197 4 224 266 354 340 228 405 153 243 28 417 169 122 480 431 332 369 377 375 201 24 113 219 171 494 251 378 362 353 347 260 166 229 464 285 3 139 358 483 100 193 65 1 221 276 498 437 312 471 291 62 40 316 75 147 462 120 50 371 326 30 384 149 145 454 390 297 70 475 132 146 373 18 427 465 161 237 383 413 355 356 359 218 410 10 392 83 47 211 322 320 144 138 200 263 280 404 387 476 168 434 49 403 85 234 274 117 238 321 58 409 440 458 441 37 142 382 360 159 56 484 89 473 217 315 352 82 164 203 302 395 66 432 110 442 151 186 214 42 29 418 259 60 112 102 335 152 137 13 294 419 420 115 133 252 451 380 444 141 81 2 479 428 400 345 317 253 279 388 107 128 346 51 11 470 103 87 14 284 300 34 78 118 148 256 496 194 331 45 443 492 12 478 283 239 421 490 195 311 367 99 309 325 72 401 254 386 31 17 416 393 39 69 244 74 111 59 299 77 293 79 461 19 27 385 247 445 319 241 156 57 206 372 344 220 296 411 399 163 286 412 36 90 64 71 328 438 35 101 140 216 298 124 327 93 265 466 262 439 92 167 348 379 329 487 449 257 424 281 52 422 398 38"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("464 376 456 34 184 250 461 418 329 400 281 317 487 105 92 259 359 150 135 66 451 221 167 378 138 11 112 404 226 130 98 434 429 170 177 355 16 266 485 242 81 22 274 58 40 336 192 185 325 290 446 278 443 318 219 295 60 363 426 123 45 407 152 199 301 343 82 178 209 498 196 364 90 271 483 189 51 220 119 431 459 103 373 161 353 99 25 396 236 91 415 52 63 320 208 232 350 294 87 406 341 198 276 335 449 149 480 94 146 223 419 75 484 445 61 59 313 201 410 297 447 342 142 467 83 207 265 19 412 314 100 395 80 218 261 417 174 85 309 32 139 212 18 351 48 430 416 465 8 388 279 423 235 72 409 62 354 114 151 53 255 252 286 158 27 17 77 200 64 206 157 14 383 377 491 41 245 15 46 106 322 315 411 231 110 42 282 249 86 291 244 187 381 78 182 111 393 497 84 370 131 496 337 31 292 74 67 228 124 147 128 175 54 264 246 215 273 238 332 49 143 172 306 26 444 6 117 37 2 408 391 195 163 474 97 23 164 379 394 462 65 213 437 441 148 481 237 425 440 275 9 171 107 222 267 316 211 29 28 101 21 492 144 35 68 460 104 398 118 300 466 457 424 285 413 140 13 471 93 372 4 258 352 345 490 229 50 321 475 115 392 387 367 194 476 365 159 180 268 173 7 473 251 120 70 1 188 382 134 493 311 76 202 478 458 421 438 304 432 448 323 10 344 358 333 169 366 160 122 488 500 108 455 247 262 495 166 385 287 386 205 5 356 477 270 181 154 129 193 347 168 310 227 361 33 254 427 331 463 3 338 20 334 57 312 499 102 489 357 137 153 73 479 69 468 283 402 224 191 89 453 280 302 399 472 339 360 197 113 248 127 307 442 39 141 380 277 256 469 183 319 289 230 253 305 95 30 299 414 422 79 260 486 296 375 217 450 369 216 397 210 233 439 156 384 38 374 371 56 225 272 346 293 165 126 176 136 204 214 186 190 403 234 71 362 36 203 241 327 24 433 133 405 436 263 420 109 239 428 340 145 116 324 482 298 389 132 162 308 326 257 88 349 243 155 330 368 12 47 452 44 269 328 121 125 55 470 179 390 43 284 494 240 435 348 303 96 454 401 288"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("410 274 27 412 182 193 199 237 279 332 132 74 462 365 167 354 263 295 164 439 288 97 500 258 213 423 6 349 260 194 92 50 157 18 429 310 345 55 275 146 31 401 196 375 377 191 269 222 308 426 340 434 28 110 326 93 123 42 104 400 198 270 261 83 383 120 328 327 173 67 24 367 476 376 448 17 101 430 496 489 81 362 215 479 287 272 460 234 7 54 475 209 283 405 78 86 130 257 88 411 309 278 119 22 442 242 414 438 393 144 369 347 329 487 386 363 451 381 149 435 47 73 372 133 71 320 238 321 390 53 181 255 160 331 19 150 498 79 12 344 299 342 355 231 75 122 1 463 230 422 483 246 392 248 109 155 108 245 90 459 419 431 168 105 192 176 424 290 77 14 380 379 147 407 185 494 478 359 413 473 10 87 453 43 63 282 491 325 467 112 360 285 177 129 232 440 153 428 207 281 116 229 56 183 99 268 233 265 26 297 432 2 20 316 39 254 240 334 259 40 433 111 461 36 236 311 408 249 205 317 76 313 286 336 357 374 458 29 469 398 94 455 197 68 350 219 85 142 499 305 485 188 51 486 161 206 107 5 301 293 339 387 59 284 11 373 156 406 15 368 384 302 45 102 454 474 49 391 131 178 241 32 296 151 201 48 252 127 447 416 318 214 480 415 337 227 437 124 70 211 113 41 174 82 247 492 351 341 221 307 137 138 128 468 126 38 143 409 319 477 118 488 361 172 457 203 353 399 244 80 271 358 266 277 444 106 189 145 421 303 289 100 300 58 404 323 420 114 490 239 202 96 152 370 210 139 218 396 280 46 30 315 298 125 64 60 171 484 364 57 338 159 84 427 466 378 382 251 352 37 216 333 417 481 425 324 89 21 33 471 115 273 162 3 190 163 385 220 452 62 497 95 443 330 103 158 225 291 4 343 304 482 449 267 170 136 204 402 371 314 208 253 250 441 394 403 397 346 212 395 25 292 495 465 294 35 356 148 184 98 436 166 446 66 493 262 23 8 9 228 226 135 154 450 175 179 13 44 200 52 186 224 187 141 312 418 335 388 456 69 389 117 217 445 264 140 348 34 276 470 121 464 180 16 472 223 72 61 366 322 169 243 306 91 195 165 134 65 256 235"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("359 450 488 131 429 51 318 212 81 49 426 204 135 194 423 197 163 418 490 458 217 243 321 76 329 90 208 431 438 499 193 317 475 292 396 152 473 107 64 365 369 180 199 386 498 324 234 427 172 8 471 339 253 333 246 330 1 138 83 347 192 80 409 207 275 479 85 449 103 62 303 389 220 461 311 136 459 362 31 445 255 411 419 215 295 261 265 500 285 141 142 95 7 235 299 260 175 179 263 361 187 161 371 300 448 406 88 65 273 202 342 440 11 357 128 166 114 343 169 383 395 305 232 271 29 25 154 495 34 451 200 167 353 422 203 293 304 287 236 91 69 453 219 378 367 425 37 176 373 174 110 444 13 56 52 258 147 441 375 268 245 104 71 468 399 146 19 294 283 123 150 54 298 270 124 28 457 323 341 36 358 102 206 387 470 266 63 385 72 160 61 97 405 496 315 391 189 259 370 355 348 140 327 414 244 21 377 316 388 145 108 237 242 47 159 336 262 332 421 286 120 18 312 133 79 497 143 296 205 137 486 381 420 443 96 201 109 23 480 184 428 121 74 482 251 290 309 368 356 125 484 277 181 350 50 30 478 408 98 38 403 382 322 195 132 464 344 177 379 432 153 412 354 364 44 27 70 196 164 59 465 439 407 84 87 454 173 209 73 374 122 249 284 165 22 77 288 248 210 6 130 46 376 115 39 314 100 213 40 472 250 26 346 227 58 151 452 274 155 416 276 158 48 267 225 134 415 463 233 211 413 148 157 12 42 101 247 14 190 224 481 331 9 68 105 487 455 302 240 474 338 310 10 118 119 483 16 392 493 417 144 397 162 485 17 269 437 170 216 328 41 226 182 424 460 4 116 313 106 126 366 335 67 289 60 297 239 466 256 218 435 337 446 325 401 198 185 494 43 281 24 127 430 320 404 221 168 222 469 231 2 393 117 186 489 33 3 476 252 264 394 223 75 32 390 93 492 78 20 436 89 278 272 99 53 447 434 92 113 238 129 442 456 301 491 178 306 384 35 57 462 372 326 279 188 156 94 111 400 340 280 352 345 171 291 5 307 183 15 257 86 214 334 55 191 398 230 149 241 228 402 308 282 467 82 66 112 319 410 254 351 380 139 229 477 349 363 433 360 45"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("81 494 158 307 152 277 38 361 380 251 452 90 247 330 140 372 306 133 243 238 99 301 197 386 86 68 414 20 41 128 181 27 138 298 440 22 394 468 348 1 73 162 403 144 13 314 235 160 249 449 125 299 136 174 98 25 342 131 370 222 479 80 355 39 151 134 385 30 497 485 466 321 345 420 400 441 426 93 450 316 437 303 371 389 96 124 217 443 483 383 92 284 351 210 186 17 295 178 236 395 179 185 429 354 225 6 279 458 302 239 121 477 415 56 431 282 57 34 129 87 143 320 435 329 358 177 9 72 32 35 373 119 245 216 294 456 281 195 115 318 157 246 359 268 337 142 427 398 120 64 126 340 16 171 406 310 224 464 214 422 391 326 352 184 259 172 78 469 367 156 289 328 347 418 199 270 101 104 163 308 155 167 193 196 242 108 67 401 362 176 29 71 423 430 221 495 244 14 50 384 325 49 356 382 213 79 472 285 486 498 60 442 365 493 23 154 55 388 229 300 387 205 21 377 360 491 315 392 378 363 274 265 169 445 218 159 379 496 260 100 180 241 47 75 164 341 408 421 173 148 45 266 424 487 470 95 84 168 105 410 208 447 463 44 409 436 127 346 413 331 170 211 292 366 257 7 194 471 273 343 228 62 76 332 2 319 290 54 390 288 252 192 122 3 231 432 153 48 438 220 58 113 31 227 350 135 263 396 202 24 296 63 269 375 481 489 42 309 149 77 91 399 204 103 203 250 393 33 215 311 428 374 453 492 484 407 305 461 381 206 490 102 52 111 165 402 88 335 264 207 59 349 474 419 237 51 85 161 297 139 280 417 201 500 198 446 293 291 130 106 478 425 333 262 283 465 36 146 37 313 187 40 411 460 112 145 324 70 107 467 272 476 278 357 405 200 454 480 132 434 147 256 94 317 254 166 336 219 12 19 304 175 397 459 61 28 233 276 344 376 15 53 26 8 69 253 191 473 439 212 248 182 271 455 240 65 43 369 353 412 116 444 234 258 141 312 117 255 190 223 267 488 11 323 10 209 123 137 457 89 109 18 339 275 110 322 66 232 83 226 448 261 74 188 334 4 183 364 189 150 114 451 97 82 462 287 499 404 433 338 230 482 118 416 475 368 46 5 286 327"); 
	mu_assert_string_eq("OK", res);
	res = run_push_swap_and_check("48 230 193 337 188 395 412 355 459 352 373 18 16 243 7 307 361 344 27 328 435 345 231 189 132 234 6 394 347 270 229 285 106 306 303 282 365 151 66 494 62 200 356 96 74 448 241 194 387 424 456 135 380 312 500 404 489 367 11 201 217 491 255 458 75 420 162 283 320 115 451 399 38 68 148 471 170 146 455 224 52 316 428 23 174 129 360 150 159 79 158 26 94 485 325 233 124 125 449 121 24 203 343 272 14 453 178 77 181 22 278 314 185 366 144 450 266 238 33 321 484 296 128 284 364 425 21 253 104 103 479 293 97 374 438 359 213 112 134 116 51 76 298 126 61 299 4 252 110 432 286 195 105 496 326 291 192 318 467 477 411 175 85 143 419 240 221 256 324 385 310 139 389 127 5 415 413 114 342 80 202 173 488 295 167 31 73 67 406 372 331 84 440 269 60 426 47 379 81 236 402 469 53 442 401 346 495 220 416 54 8 101 209 472 184 131 447 351 279 457 470 160 353 410 57 403 119 210 309 319 71 264 152 350 275 29 235 108 214 30 191 180 169 118 215 13 388 28 276 396 433 329 400 19 369 50 460 172 258 280 289 187 207 3 204 90 25 423 100 153 218 206 481 117 242 441 34 251 311 277 268 186 163 335 219 212 247 340 315 164 95 382 427 111 133 397 486 259 339 43 254 155 165 10 348 482 465 357 462 136 368 492 35 443 439 409 383 262 330 20 376 239 274 176 302 227 267 497 398 113 327 292 36 56 166 392 349 197 422 317 122 156 354 260 154 145 297 377 461 102 226 408 137 473 381 437 414 265 338 222 78 263 142 390 468 332 72 421 161 2 183 333 99 407 64 70 393 91 17 168 109 245 98 58 384 93 147 171 120 429 301 69 246 205 281 431 182 499 237 358 86 88 199 290 375 138 42 288 363 63 149 130 107 466 9 271 362 454 157 445 59 478 225 341 249 228 476 304 49 287 32 123 480 475 493 308 334 417 474 378 305 273 1 190 418 248 322 87 216 92 490 211 434 196 179 39 371 41 300 141 483 391 177 40 430 82 244 294 446 89 15 444 436 12 198 336 452 257 250 464 313 45 323 487 37 498 65 223 83 208 370 232 140 55 46 463 405 386 261 44"); 
	mu_assert_string_eq("OK", res);
}
/* --- SUITE --- */

MU_TEST_SUITE(push_swap_test_suite)
{
	MU_RUN_TEST(test_checker_valid_input);
	MU_RUN_TEST(test_checker_invalid_input);
	MU_RUN_TEST(test_checker_valid_signed_number);
	MU_RUN_TEST(test_checker_three_elements);
	MU_RUN_TEST(test_checker_five_elements);
	MU_RUN_TEST(test_checker_100_elements);
	MU_RUN_TEST(test_checker_500_elements);
}
